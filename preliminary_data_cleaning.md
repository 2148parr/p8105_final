preliminary\_data\_cleaning
================

## Importing NHATS data and selecting only relevant variables

Using only round 5 data, included ID variable, the two variables needed
for the depression risk scale (PHQ-2), gender, age, race, whether
participant uses mobility devices, size of social network, whether or
not they have no one to talk to, self reported memory issues causing
problems, self-rated health, and whether they are happy with their
living situation.

In creating dichotomous variable phq\_cat regarding depression status,
phq.total was subtracted by 2 to account for the fact that total scores
on the PHQ-2 should range from 0-6 (sum of two items ranging from 0-3,
while scores for the two items provided in our data ranged from 1-4).
Once 2 was subtracted from the total score, phq\_cat was dichotomized
based on a cutoff point of 3 or higher.

``` r
nhats = read_sas("./final_data/nhats_r5.sas7bdat")  %>%
  select(spid, hc5depresan1, hc5depresan2, r5dgender, r5d2intvrage, rl5dracehisp, md5canewlker, 
         sn5dnumsn, cg5ratememry, hc5health, wb5truestme4, fl5noonetalk, cg5ofmemprob) %>%
  janitor::clean_names() %>%   
  filter(hc5depresan1 > 0, hc5depresan2 > 0, sn5dnumsn >= 0, r5d2intvrage > 0, md5canewlker > 0, 
         cg5ratememry > 0, hc5health > 0, wb5truestme4 > 0, rl5dracehisp < 5)

nhats %>% 
  select(hc5depresan1, hc5depresan2)  %>% 
  rowSums(na.rm = TRUE) -> nhats$phq.total

nhats = nhats %>%
  mutate(phq.total = phq.total - 2) %>% 
  mutate(phq_cat = if_else(phq.total < 3, "Mild/No Depression", "Moderate/Severe Depression")) %>% 
  mutate(
    gender = recode(r5dgender, `1` = "Male", `2` = "Female"),
    gender = as.factor(gender),
    age_cat = recode(r5d2intvrage, `1` = "65 to 69", `2` = "70 to 74", `3` = "75 to 79", 
                 `4` = "80 to 84", `5` = "85 to 89", `6` = "90+"),
    age_cat = factor(age_cat, levels = c("65 to 69", "70 to 74", "75 to 79", "80 to 84", 
                  "85 to 89", "90+"), ordered = TRUE),
    race_ethnicity = recode(rl5dracehisp, `1` = "White, non-hispanic", `2` = "Black, non-hispanic", 
                  `3` = "Other, non-hispanic", `4` = "Hispanic", `5` = "More than one DKRF primary", 
                  `6` = "DKRF"),
    race_ethnicity = factor(race_ethnicity),
    cane_walker_wheelchair = recode(md5canewlker, `1` = "Yes", `2` = "No"),
    cane_walker_wheelchair = factor(cane_walker_wheelchair),
    memory = recode(cg5ratememry, `1` = "Excellent", `2` = "Very Good", `3` = "Good", 
                    `4` = "Fair", `5` = "Poor"),
    memory = factor(memory, c("Excellent", "Very Good", "Good", "Fair", "Poor"), 
                    ordered = TRUE),
    overall_health = recode(hc5health, `1` = "Excellent", `2` = "Very Good", `3` = "Good", 
                    `4` = "Fair", `5` = "Poor"),
    overall_health = factor(overall_health, levels = c("Excellent", "Very Good", "Good", "Fair", 
                    "Poor"), ordered = TRUE),
    likes_living_situation = recode(wb5truestme4, `1` = "Agree a lot", `2` = "Agree a little", 
                    `3` = "Agree not at all"),
    likes_living_situation = factor(likes_living_situation, c("Agree a lot", "Agree a little", 
                    "Agree not at all"), ordered = TRUE)
)
```

Preliminary exploratory visualizations: \# for gender - 1 male, 2 female
\# for age categories - 1 65-69, 2 70-74, 5 75-79, 4 80 - 84, 5 85-89, 6
90+ \# for racehisp - 1 white non-hispanic, 2 black non-hispanic, 3
other non-hispanic, 4, hispanic, 5 more than one/dkrf primary

``` r
gender_bar = 
  nhats  %>%   
  count(gender) %>% 
  mutate(gender = as.factor(gender),
         gender = fct_reorder(gender, n)) %>% 
  plot_ly(x = ~gender, y = ~n, color = ~gender, type = "bar", colors = "viridis") %>% 
  layout(plot_bgcolor = "f8f8f8",
         xaxis = list(title = "participant gender", tickfont = list(size = 11)), 
         yaxis = list(title = "frequency"), 
         title = "Gender",  
         titlefont = list(size = 16),
         showlegend = FALSE)

age_bar = 
  nhats  %>%   
  count(age_cat) %>% 
  mutate(age_cat = as.factor(age_cat),
         age_cat = fct_reorder(age_cat, n)) %>% 
  plot_ly(x = ~age_cat, y = ~n, color = ~age_cat, type = "bar", colors = "viridis") %>% 
  layout(plot_bgcolor = "f8f8f8",
         xaxis = list(title = "participant age", tickfont = list(size = 11)), 
         yaxis = list(title = "frequency"), 
         title = "Age",  
         titlefont = list(size = 16),
         showlegend = FALSE)

race_bar = 
  nhats  %>%   
  count(race_ethnicity) %>% 
  mutate(race_ethnicity = as.factor(race_ethnicity),
         race_ethnicity = fct_reorder(race_ethnicity, n)) %>% 
  plot_ly(x = ~race_ethnicity, y = ~n, color = ~race_ethnicity, type = "bar", colors = "viridis") %>% 
  layout(plot_bgcolor = "f8f8f8",
         xaxis = list(title = "participant race/ethnicity", tickfont = list(size = 11)), 
         yaxis = list(title = "frequency"), 
         title = "Race/Ethnicity",  
         titlefont = list(size = 16),
         showlegend = FALSE)

demo_bar = subplot(gender_bar, age_bar, race_bar, nrows = 3) %>%
  layout(xaxis3 = list(title = "categories"), 
         yaxis2 = list(title = "frequency"),
         title = list(text = "Demographic frequencies"), 
         titlefont = list(size = 14),
         legend = list(font = list(size = 10)))
```

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

``` r
demo_bar 
```

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

<div id="htmlwidget-0646594cf62476e093b9" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0646594cf62476e093b9">{"x":{"data":[{"x":["Male"],"y":[2869],"type":"bar","name":"Male","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Female"],"y":[3924],"type":"bar","name":"Female","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["70 to 74"],"y":[1651],"type":"bar","name":"70 to 74","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["75 to 79"],"y":[1478],"type":"bar","name":"75 to 79","marker":{"color":"rgba(122,209,81,1)","line":{"color":"rgba(122,209,81,1)"}},"textfont":{"color":"rgba(122,209,81,1)"},"error_y":{"color":"rgba(122,209,81,1)"},"error_x":{"color":"rgba(122,209,81,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["80 to 84"],"y":[1269],"type":"bar","name":"80 to 84","marker":{"color":"rgba(34,168,132,1)","line":{"color":"rgba(34,168,132,1)"}},"textfont":{"color":"rgba(34,168,132,1)"},"error_y":{"color":"rgba(34,168,132,1)"},"error_x":{"color":"rgba(34,168,132,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["65 to 69"],"y":[981],"type":"bar","name":"65 to 69","marker":{"color":"rgba(42,120,142,1)","line":{"color":"rgba(42,120,142,1)"}},"textfont":{"color":"rgba(42,120,142,1)"},"error_y":{"color":"rgba(42,120,142,1)"},"error_x":{"color":"rgba(42,120,142,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["85 to 89"],"y":[885],"type":"bar","name":"85 to 89","marker":{"color":"rgba(65,68,135,1)","line":{"color":"rgba(65,68,135,1)"}},"textfont":{"color":"rgba(65,68,135,1)"},"error_y":{"color":"rgba(65,68,135,1)"},"error_x":{"color":"rgba(65,68,135,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["90+"],"y":[529],"type":"bar","name":"90+","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["Other, non-hispanic"],"y":[187],"type":"bar","name":"Other, non-hispanic","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["Hispanic"],"y":[382],"type":"bar","name":"Hispanic","marker":{"color":"rgba(49,104,142,1)","line":{"color":"rgba(49,104,142,1)"}},"textfont":{"color":"rgba(49,104,142,1)"},"error_y":{"color":"rgba(49,104,142,1)"},"error_x":{"color":"rgba(49,104,142,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["Black, non-hispanic"],"y":[1412],"type":"bar","name":"Black, non-hispanic","marker":{"color":"rgba(53,183,121,1)","line":{"color":"rgba(53,183,121,1)"}},"textfont":{"color":"rgba(53,183,121,1)"},"error_y":{"color":"rgba(53,183,121,1)"},"error_x":{"color":"rgba(53,183,121,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["White, non-hispanic"],"y":[4812],"type":"bar","name":"White, non-hispanic","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"xaxis":"x3","yaxis":"y3","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"tickfont":{"size":11},"type":"category","categoryorder":"array","categoryarray":["Male","Female"],"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"tickfont":{"size":11},"type":"category","categoryorder":"array","categoryarray":["90+","85 to 89","65 to 69","80 to 84","75 to 79","70 to 74"],"anchor":"y2"},"xaxis3":{"domain":[0,1],"automargin":true,"tickfont":{"size":11},"type":"category","categoryorder":"array","categoryarray":["Other, non-hispanic","Hispanic","Black, non-hispanic","White, non-hispanic"],"anchor":"y3","title":"categories"},"yaxis3":{"domain":[0,0.313333333333333],"automargin":true,"anchor":"x3"},"yaxis2":{"domain":[0.353333333333333,0.646666666666667],"automargin":true,"anchor":"x2","title":"frequency"},"yaxis":{"domain":[0.686666666666667,1],"automargin":true,"anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"f8f8f8","title":{"text":"Demographic frequencies"},"titlefont":{"size":14},"showlegend":false,"hovermode":"closest","legend":{"font":{"size":10}}},"attrs":{"852a1a9d00b1":{"x":{},"y":{},"color":{},"colors":"viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"852a3998721d":{"x":{},"y":{},"color":{},"colors":"viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"852a476beb75":{"x":{},"y":{},"color":{},"colors":"viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

Plotting of likes living situation predictor against PHQ-2, stratified
by race (EM) \#currently broken :( can anyone tell why?

``` r
ll_white = 
  nhats %>%   
  filter(race_ethnicity == 1 ) %>% 
  plot_ly(x = ~jitter(wb5truestme4, 1), y = ~jitter(phq.total, 1), color = ~wb5truestme4, type = "scatter", 
          mode = "markers", marker = list(color = "red")) %>% 
  layout(plot_bgcolor = "fffefa") 

ll_black = 
  nhats %>%   
  filter(race_ethnicity == 2 ) %>% 
  plot_ly(x = ~jitter(wb5truestme4, 1), y = ~jitter(phq.total, 1), color = ~wb5truestme4, type = "scatter", 
          mode = "markers", marker = list(color = "blue")) %>% 
  layout(plot_bgcolor = "fffefa") 

ll_other = 
  nhats %>%   
  filter(race_ethnicity == 3 ) %>% 
  plot_ly(x = ~jitter(wb5truestme4, 1), y = ~jitter(phq.total, 1), color = ~wb5truestme4, type = "scatter", 
          mode = "markers", marker = list(color = "green")) %>% 
  layout(plot_bgcolor = "fffefa") 

ll_hisp = 
  nhats %>%   
  filter(race_ethnicity == 4 ) %>% 
  plot_ly(x = ~jitter(wb5truestme4, 1), y = ~jitter(phq.total, 1), color = ~wb5truestme4, type = "scatter", 
          mode = "markers", marker = list(color = "orange")) %>% 
  layout(plot_bgcolor = "fffefa") 


ll_scatter = subplot(ll_white, ll_black, ll_other, ll_hisp, nrows = 4) %>%
  layout(xaxis4 = list(title = "likes living situation"), 
         yaxis2 = list(title = "PHQ-2"),
         title = list(text = "Participant view of living situation and PHQ-2 score distribution"), 
         titlefont = list(size = 14),
         legend = list(font = list(size = 10)))

ll_scatter 
```

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

<div id="htmlwidget-0aec519e79ecef06d91f" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0aec519e79ecef06d91f">{"x":{"data":[{"mode":"markers","marker":{"color":"red","line":{"color":"rgba(31,119,180,1)"}},"type":"scatter","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"markers","marker":{"color":"blue","line":{"color":"rgba(255,127,14,1)"}},"type":"scatter","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"mode":"markers","marker":{"color":"green","line":{"color":"rgba(44,160,44,1)"}},"type":"scatter","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"mode":"markers","marker":{"color":"orange","line":{"color":"rgba(214,39,40,1)"}},"type":"scatter","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x4","yaxis":"y4","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"anchor":"y2"},"xaxis3":{"domain":[0,1],"automargin":true,"anchor":"y3"},"xaxis4":{"domain":[0,1],"automargin":true,"anchor":"y4","title":"likes living situation"},"yaxis4":{"domain":[0,0.23],"automargin":true,"anchor":"x4"},"yaxis3":{"domain":[0.27,0.48],"automargin":true,"anchor":"x3"},"yaxis2":{"domain":[0.52,0.73],"automargin":true,"anchor":"x2","title":"PHQ-2"},"yaxis":{"domain":[0.77,1],"automargin":true,"anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"fffefa","hovermode":"closest","showlegend":true,"title":{"text":"Participant view of living situation and PHQ-2 score distribution"},"titlefont":{"size":14},"legend":{"font":{"size":10}}},"attrs":{"852a5d2431e4":{"x":{},"y":{},"mode":"markers","marker":{"color":"red"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"852a73479f81":{"x":{},"y":{},"mode":"markers","marker":{"color":"blue"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"852a63390947":{"x":{},"y":{},"mode":"markers","marker":{"color":"green"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"852a35904735":{"x":{},"y":{},"mode":"markers","marker":{"color":"orange"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

Plotting social network and health by phq\_cat:

``` r
sn_phq = nhats %>% 
  ggplot(aes(x = sn5dnumsn, group = phq_cat)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat = "count") +
    geom_text(aes( label = scales::percent(round(..prop.., 3)),
                   y = ..prop.. ), stat = "count", vjust = -.3, size = 2.5) +
    labs(y = "Percent", fill = "SN") +
    facet_grid(~phq_cat) +
    scale_y_continuous(labels = scales::percent)

ggplotly(sn_phq)
```

<div id="htmlwidget-feac3ca7d5ba34d17b4e" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-feac3ca7d5ba34d17b4e">{"x":{"data":[{"orientation":"v","width":0.9,"base":0,"x":[0],"y":[0.0474354676500168],"text":"sn5dnumsn: 0<br />phq_cat: Mild/No Depression<br />prop: 0.04743547<br />factor(x): 0","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"0","legendgroup":"0","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[0],"y":[0.0665054413542926],"text":"sn5dnumsn: 0<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06650544<br />factor(x): 0","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"0","legendgroup":"0","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.32769024472008],"text":"sn5dnumsn: 1<br />phq_cat: Mild/No Depression<br />prop: 0.32769024<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(183,159,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.348246674727932],"text":"sn5dnumsn: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.34824667<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(183,159,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.268856855514583],"text":"sn5dnumsn: 2<br />phq_cat: Mild/No Depression<br />prop: 0.26885686<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.290205562273277],"text":"sn5dnumsn: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29020556<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.176835400603419],"text":"sn5dnumsn: 3<br />phq_cat: Mild/No Depression<br />prop: 0.17683540<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.159613059250302],"text":"sn5dnumsn: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.15961306<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.096882333221589],"text":"sn5dnumsn: 4<br />phq_cat: Mild/No Depression<br />prop: 0.09688233<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.0701330108827086],"text":"sn5dnumsn: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.07013301<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.0822996982903118],"text":"sn5dnumsn: 5<br />phq_cat: Mild/No Depression<br />prop: 0.08229970<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(245,100,227,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.0652962515114873],"text":"sn5dnumsn: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06529625<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(245,100,227,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5],"y":[0.0474354676500168,0.32769024472008,0.268856855514583,0.176835400603419,0.096882333221589,0.0822996982903118],"text":["4.70%","32.80%","26.90%","17.70%","9.70%","8.20%"],"hovertext":["sn5dnumsn: 0<br />phq_cat: Mild/No Depression<br />prop: 0.04743547<br />scales::percent(round(prop, 3)): 4.70%","sn5dnumsn: 1<br />phq_cat: Mild/No Depression<br />prop: 0.32769024<br />scales::percent(round(prop, 3)): 32.80%","sn5dnumsn: 2<br />phq_cat: Mild/No Depression<br />prop: 0.26885686<br />scales::percent(round(prop, 3)): 26.90%","sn5dnumsn: 3<br />phq_cat: Mild/No Depression<br />prop: 0.17683540<br />scales::percent(round(prop, 3)): 17.70%","sn5dnumsn: 4<br />phq_cat: Mild/No Depression<br />prop: 0.09688233<br />scales::percent(round(prop, 3)): 9.70%","sn5dnumsn: 5<br />phq_cat: Mild/No Depression<br />prop: 0.08229970<br />scales::percent(round(prop, 3)): 8.20%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5],"y":[0.0665054413542926,0.348246674727932,0.290205562273277,0.159613059250302,0.0701330108827086,0.0652962515114873],"text":["6.70%","34.80%","29.00%","16.00%","7.00%","6.50%"],"hovertext":["sn5dnumsn: 0<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06650544<br />scales::percent(round(prop, 3)): 6.70%","sn5dnumsn: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.34824667<br />scales::percent(round(prop, 3)): 34.80%","sn5dnumsn: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29020556<br />scales::percent(round(prop, 3)): 29.00%","sn5dnumsn: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.15961306<br />scales::percent(round(prop, 3)): 16.00%","sn5dnumsn: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.07013301<br />scales::percent(round(prop, 3)): 7.00%","sn5dnumsn: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06529625<br />scales::percent(round(prop, 3)): 6.50%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.9178082191781,"r":18.9954337899543,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[-0.745,5.745],"tickmode":"array","ticktext":["0","2","4"],"tickvals":[0,2,4],"categoryorder":"array","categoryarray":["0","2","4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"sn5dnumsn","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":"Percent","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.7625570776256},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0174123337363966,0.365659008464329],"tickmode":"array","ticktext":["0%","10%","20%","30%"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0%","10%","20%","30%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[-0.745,5.745],"tickmode":"array","ticktext":["0","2","4"],"tickvals":[0,2,4],"categoryorder":"array","categoryarray":["0","2","4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"SN","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"852a27d97fc4":{"x":{},"y":{},"fill":{},"type":"bar"},"852a3853314c":{"x":{},"y":{},"label":{}}},"cur_data":"852a27d97fc4","visdat":{"852a27d97fc4":["function (y) ","x"],"852a3853314c":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

``` r
health_phq = nhats %>% 
  filter(hc5health > 0) %>%
  ggplot(aes(x = hc5health, group = phq_cat)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat = "count") +
    geom_text(aes( label = scales::percent(round(..prop.., 3)),
                   y = ..prop.. ), stat = "count", vjust = -.3, size = 2.5) +
    labs(y = "Percent", fill = "SN") +
    facet_grid(~phq_cat) +
    scale_y_continuous(labels = scales::percent)

ggplotly(health_phq)
```

<div id="htmlwidget-0efbab8d1bb087af2e0a" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0efbab8d1bb087af2e0a">{"x":{"data":[{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.130573248407643],"text":"hc5health: 1<br />phq_cat: Mild/No Depression<br />prop: 0.13057325<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.033857315598549],"text":"hc5health: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.03385732<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.314280925243044],"text":"hc5health: 2<br />phq_cat: Mild/No Depression<br />prop: 0.31428093<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.13180169286578],"text":"hc5health: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.13180169<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.348474689909487],"text":"hc5health: 3<br />phq_cat: Mild/No Depression<br />prop: 0.34847469<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.296251511487303],"text":"hc5health: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29625151<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.176332551123031],"text":"hc5health: 4<br />phq_cat: Mild/No Depression<br />prop: 0.17633255<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.351874244256348],"text":"hc5health: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.35187424<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.0303385853167952],"text":"hc5health: 5<br />phq_cat: Mild/No Depression<br />prop: 0.03033859<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.186215235792019],"text":"hc5health: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.18621524<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5],"y":[0.130573248407643,0.314280925243044,0.348474689909487,0.176332551123031,0.0303385853167952],"text":["13.100%","31.400%","34.800%","17.600%","3.000%"],"hovertext":["hc5health: 1<br />phq_cat: Mild/No Depression<br />prop: 0.13057325<br />scales::percent(round(prop, 3)): 13.100%","hc5health: 2<br />phq_cat: Mild/No Depression<br />prop: 0.31428093<br />scales::percent(round(prop, 3)): 31.400%","hc5health: 3<br />phq_cat: Mild/No Depression<br />prop: 0.34847469<br />scales::percent(round(prop, 3)): 34.800%","hc5health: 4<br />phq_cat: Mild/No Depression<br />prop: 0.17633255<br />scales::percent(round(prop, 3)): 17.600%","hc5health: 5<br />phq_cat: Mild/No Depression<br />prop: 0.03033859<br />scales::percent(round(prop, 3)): 3.000%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5],"y":[0.033857315598549,0.13180169286578,0.296251511487303,0.351874244256348,0.186215235792019],"text":["3.400%","13.200%","29.600%","35.200%","18.600%"],"hovertext":["hc5health: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.03385732<br />scales::percent(round(prop, 3)): 3.400%","hc5health: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.13180169<br />scales::percent(round(prop, 3)): 13.200%","hc5health: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29625151<br />scales::percent(round(prop, 3)): 29.600%","hc5health: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.35187424<br />scales::percent(round(prop, 3)): 35.200%","hc5health: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.18621524<br />scales::percent(round(prop, 3)): 18.600%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.9178082191781,"r":18.9954337899543,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.305,5.695],"tickmode":"array","ticktext":["1","2","3","4","5"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["1","2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"hc5health","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":"Percent","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.7625570776256},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0175937122128174,0.369467956469166],"tickmode":"array","ticktext":["0%","10%","20%","30%"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0%","10%","20%","30%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.305,5.695],"tickmode":"array","ticktext":["1","2","3","4","5"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["1","2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"SN","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"852a508703cc":{"x":{},"y":{},"fill":{},"type":"bar"},"852a500a6f61":{"x":{},"y":{},"label":{}}},"cur_data":"852a508703cc","visdat":{"852a508703cc":["function (y) ","x"],"852a500a6f61":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

### Plotting memory x depression outcomes

*onyeka*

``` r
mem_plot = nhats %>%  mutate(
                          phq_cat = factor(phq_cat),
                          cane_walker_cat = factor(md5canewlker),
                          noone_talk = factor(fl5noonetalk),
                          mem_probs = factor(cg5ofmemprob)) %>% group_by(phq_cat, mem_probs) %>% 
  summarise(n = n()) %>% mutate(
  proportion = (n / sum(n))
  )
```

    ## `summarise()` has grouped output by 'phq_cat'. You can override using the `.groups` argument.

``` r
  memory_plot = mem_plot %>%  ggplot(aes(x = mem_probs, y = proportion, group= phq_cat)) + 
    geom_line()  +  
   geom_point(alpha = 0.5, color = "red") + 
    facet_grid(~phq_cat) + 
    labs( title = "Severity of memory problems and Depression outcomes",
      x = "Severity level of problems with memory", y = " Proportion of respondents")+  
    scale_x_discrete(
      labels = c("Everyday","Most days","Some days","Rarely","Never")) + 
    scale_y_continuous(labels = scales::percent)
  
  ggplotly(memory_plot)
```

<div id="htmlwidget-d4b03aa67af553cf5a0f" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-d4b03aa67af553cf5a0f">{"x":{"data":[{"x":[1,2,3,4,5,6,7],"y":[0.00050284948038887,0.425913509889373,0.0258129399932953,0.0256453234998324,0.149849145155883,0.206000670465974,0.166275561515253],"text":["mem_probs: -8<br />proportion: 0.0005028495<br />phq_cat: Mild/No Depression","mem_probs: -1<br />proportion: 0.4259135099<br />phq_cat: Mild/No Depression","mem_probs: 1<br />proportion: 0.0258129400<br />phq_cat: Mild/No Depression","mem_probs: 2<br />proportion: 0.0256453235<br />phq_cat: Mild/No Depression","mem_probs: 3<br />proportion: 0.1498491452<br />phq_cat: Mild/No Depression","mem_probs: 4<br />proportion: 0.2060006705<br />phq_cat: Mild/No Depression","mem_probs: 5<br />proportion: 0.1662755615<br />phq_cat: Mild/No Depression"],"type":"scatter","mode":"lines+markers","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(255,0,0,1)","opacity":0.5,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)"}},"frame":null},{"x":[1,2,3,4,5,6,7],"y":[0.00362756952841596,0.267230955259976,0.0749697702539299,0.0894800483675937,0.274486094316808,0.162031438935913,0.128174123337364],"text":["mem_probs: -8<br />proportion: 0.0036275695<br />phq_cat: Moderate/Severe Depression","mem_probs: -1<br />proportion: 0.2672309553<br />phq_cat: Moderate/Severe Depression","mem_probs: 1<br />proportion: 0.0749697703<br />phq_cat: Moderate/Severe Depression","mem_probs: 2<br />proportion: 0.0894800484<br />phq_cat: Moderate/Severe Depression","mem_probs: 3<br />proportion: 0.2744860943<br />phq_cat: Moderate/Severe Depression","mem_probs: 4<br />proportion: 0.1620314389<br />phq_cat: Moderate/Severe Depression","mem_probs: 5<br />proportion: 0.1281741233<br />phq_cat: Moderate/Severe Depression"],"type":"scatter","mode":"lines+markers","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(255,0,0,1)","opacity":0.5,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)"}},"frame":null}],"layout":{"margin":{"t":55.4520547945205,"r":18.9954337899543,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Severity of memory problems and Depression outcomes","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.4,7.6],"tickmode":"array","ticktext":["Everyday","Most days","Some days","Rarely","Never"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["Everyday","Most days","Some days","Rarely","Never"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"Severity level of problems with memory","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":" Proportion of respondents","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-39.4520547945205},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0207676835400603,0.447184042909822],"tickmode":"array","ticktext":["0.0%","10.0%","20.0%","30.0%","40.0%"],"tickvals":[0,0.1,0.2,0.3,0.4],"categoryorder":"array","categoryarray":["0.0%","10.0%","20.0%","30.0%","40.0%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.4,7.6],"tickmode":"array","ticktext":["Everyday","Most days","Some days","Rarely","Never"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["Everyday","Most days","Some days","Rarely","Never"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"852a5b20882c":{"x":{},"y":{},"type":"scatter"},"852a34cc2f71":{"x":{},"y":{}}},"cur_data":"852a5b20882c","visdat":{"852a5b20882c":["function (y) ","x"],"852a34cc2f71":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

### plotting cane walker use *onyeka*

``` r
cane_plot = nhats %>%  
  mutate(
    cane_walker_cat = factor(md5canewlker)) %>% 
    filter(cane_walker_cat != -8) %>%  
    group_by(phq_cat, cane_walker_cat) %>% 
    summarise(n = n()) %>%  
    mutate(
        proportion = (n / sum(n)))
```

    ## `summarise()` has grouped output by 'phq_cat'. You can override using the `.groups` argument.

``` r
canewalker_plot = cane_plot %>%  
ggplot(aes(x = cane_walker_cat, y =proportion)) + 
  geom_col(fill= "light blue") + facet_grid(~phq_cat)+
  labs( title = "Use of cane walker wheelchair and depression outcomes",
      x = "Asked if used a cane walker wheel chair", y = " Proportion of respondents")+  
    scale_x_discrete(
      labels = c("Yes","No")) + 
    scale_y_continuous(labels = scales::percent)

  ggplotly(canewalker_plot)
```

<div id="htmlwidget-03d0fa4c061be9e57d8c" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-03d0fa4c061be9e57d8c">{"x":{"data":[{"orientation":"v","width":[0.9,0.9],"base":[0,0],"x":[1,2],"y":[0.273047267851157,0.726952732148843],"text":["cane_walker_cat: 1<br />proportion: 0.2730473","cane_walker_cat: 2<br />proportion: 0.7269527"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(173,216,230,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9],"base":[0,0],"x":[1,2],"y":[0.489721886336155,0.510278113663845],"text":["cane_walker_cat: 1<br />proportion: 0.4897219","cane_walker_cat: 2<br />proportion: 0.5102781"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(173,216,230,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":55.4520547945205,"r":18.9954337899543,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Use of cane walker wheelchair and depression outcomes","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.4,2.6],"tickmode":"array","ticktext":["Yes","No"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["Yes","No"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"Asked if used a cane walker wheel chair","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":" Proportion of respondents","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.7625570776256},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0363476366074422,0.763300368756286],"tickmode":"array","ticktext":["0%","20%","40%","60%"],"tickvals":[0,0.2,0.4,0.6],"categoryorder":"array","categoryarray":["0%","20%","40%","60%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.4,2.6],"tickmode":"array","ticktext":["Yes","No"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["Yes","No"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"852a78d547c8":{"x":{},"y":{},"type":"bar"}},"cur_data":"852a78d547c8","visdat":{"852a78d547c8":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
