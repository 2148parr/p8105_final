preliminary\_data\_cleaning
================

## Importing NHATS data and selecting only relevant variables

Using only round 5 data, included ID variable, the two variables needed
for the depression risk scale (PHQ-2), gender, age, race, whether
participant uses mobility devices, size of social network, whether or
not they have no one to talk to, self reported memory issues causing
problems, self-rated health, and whether they are happy with their
living situation.

In creating dichotomous variable phq\_cat regarding depression status,
phq.total was subtracted by 2 to account for the fact that total scores
on the PHQ-2 should range from 0-6 (sum of two items ranging from 0-3,
while scores for the two items provided in our data ranged from 1-4).
Once 2 was subtracted from the total score, phq\_cat was dichotomized
based on a cutoff point of 3 or higher.

``` r
nhats = read_sas("./final_data/nhats_r5.sas7bdat")  %>%
  select(spid, hc5depresan1, hc5depresan2, r5dgender, r5d2intvrage, rl5dracehisp, md5canewlker, 
         sn5dnumsn, cg5ratememry, hc5health, wb5truestme4, fl5noonetalk, cg5ofmemprob) %>%
  janitor::clean_names() %>%   
  filter(hc5depresan1 > 0, hc5depresan2 > 0, sn5dnumsn >= 0, r5d2intvrage > 0, md5canewlker > 0, 
         cg5ratememry > 0, hc5health > 0, wb5truestme4 > 0)

nhats %>% 
  select(hc5depresan1, hc5depresan2)  %>% 
  rowSums(na.rm = TRUE) -> nhats$phq.total

nhats = nhats %>%
  mutate(phq.total = phq.total - 2) %>% 
  mutate(phq_cat = if_else(phq.total < 3, "Mild/No Depression", "Moderate/Severe Depression")) %>% 
  mutate(
    gender = recode(r5dgender, `1` = "Male", `2` = "Female"),
    gender = as.factor(gender),
    age_cat = recode(r5d2intvrage, `1` = "65 to 69", `2` = "70 to 74", `3` = "75 to 79", 
                 `4` = "80 to 84", `5` = "85 to 89", `6` = "90+"),
    age_cat = factor(age_cat, levels = c("65 to 69", "70 to 74", "75 to 79", "80 to 84", 
                  "85 to 89", "90+"), ordered = TRUE),
    race_ethnicity = recode(rl5dracehisp, `1` = "White, non-hispanic", `2` = "Black, non-hispanic", 
                  `3` = "Other, non-hispanic", `4` = "Hispanic", `5` = "More than one DKRF primary", 
                  `6` = "DKRF"),
    race_ethnicity = factor(race_ethnicity),
    cane_walker_wheelchair = recode(md5canewlker, `1` = "Yes", `2` = "No"),
    cane_walker_wheelchair = factor(cane_walker_wheelchair),
    memory = recode(cg5ratememry, `1` = "Excellent", `2` = "Very Good", `3` = "Good", 
                    `4` = "Fair", `5` = "Poor"),
    memory = factor(memory, c("Excellent", "Very Good", "Good", "Fair", "Poor"), 
                    ordered = TRUE),
    overall_health = recode(hc5health, `1` = "Excellent", `2` = "Very Good", `3` = "Good", 
                    `4` = "Fair", `5` = "Poor"),
    overall_health = factor(overall_health, levels = c("Excellent", "Very Good", "Good", "Fair", 
                    "Poor"), ordered = TRUE),
    likes_living_situation = recode(wb5truestme4, `1` = "Agree a lot", `2` = "Agree a little", 
                    `3` = "Agree not at all"),
    likes_living_situation = factor(likes_living_situation, c("Agree a lot", "Agree a little", 
                    "Agree not at all"), ordered = TRUE)
)
```

Preliminary exploratory visualizations: \# for gender - 1 male, 2 female
\# for age categories - 1 65-69, 2 70-74, 5 75-79, 4 80 - 84, 5 85-89, 6
90+ \# for racehisp - 1 white non-hispanic, 2 black non-hispanic, 3
other non-hispanic, 4, hispanic, 5 more than one/dkrf primary

``` r
gender_bar = 
  nhats  %>%   
  count(gender) %>% 
  mutate(gender = as.factor(gender),
         gender = fct_reorder(gender, n)) %>% 
  plot_ly(x = ~gender, y = ~n, color = ~gender, type = "bar", colors = "viridis") %>% 
  layout(plot_bgcolor = "f8f8f8",
         xaxis = list(title = "participant gender", tickfont = list(size = 11)), 
         yaxis = list(title = "frequency"), 
         title = "Gender",  
         titlefont = list(size = 16),
         showlegend = FALSE)

age_bar = 
  nhats  %>%   
  count(age_cat) %>% 
  mutate(age_cat = as.factor(age_cat),
         age_cat = fct_reorder(age_cat, n)) %>% 
  plot_ly(x = ~age_cat, y = ~n, color = ~age_cat, type = "bar", colors = "viridis") %>% 
  layout(plot_bgcolor = "f8f8f8",
         xaxis = list(title = "participant age", tickfont = list(size = 11)), 
         yaxis = list(title = "frequency"), 
         title = "Age",  
         titlefont = list(size = 16),
         showlegend = FALSE)

race_bar = 
  nhats  %>%   
  count(race_ethnicity) %>% 
  mutate(race_ethnicity = as.factor(race_ethnicity),
         race_ethnicity = fct_reorder(race_ethnicity, n)) %>% 
  plot_ly(x = ~race_ethnicity, y = ~n, color = ~race_ethnicity, type = "bar", colors = "viridis") %>% 
  layout(plot_bgcolor = "f8f8f8",
         xaxis = list(title = "participant race/ethnicity", tickfont = list(size = 11)), 
         yaxis = list(title = "frequency"), 
         title = "Race/Ethnicity",  
         titlefont = list(size = 16),
         showlegend = FALSE)

demo_bar = subplot(gender_bar, age_bar, race_bar, nrows = 3) %>%
  layout(xaxis3 = list(title = "categories"), 
         yaxis2 = list(title = "frequency"),
         title = list(text = "Demographic frequencies"), 
         titlefont = list(size = 14),
         legend = list(font = list(size = 10)))
```

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

``` r
demo_bar 
```

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

<div id="htmlwidget-64c8dfe68b00bcf84b1a" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-64c8dfe68b00bcf84b1a">{"x":{"data":[{"x":["Male"],"y":[2883],"type":"bar","name":"Male","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Female"],"y":[3945],"type":"bar","name":"Female","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["70 to 74"],"y":[1664],"type":"bar","name":"70 to 74","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["75 to 79"],"y":[1484],"type":"bar","name":"75 to 79","marker":{"color":"rgba(122,209,81,1)","line":{"color":"rgba(122,209,81,1)"}},"textfont":{"color":"rgba(122,209,81,1)"},"error_y":{"color":"rgba(122,209,81,1)"},"error_x":{"color":"rgba(122,209,81,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["80 to 84"],"y":[1275],"type":"bar","name":"80 to 84","marker":{"color":"rgba(34,168,132,1)","line":{"color":"rgba(34,168,132,1)"}},"textfont":{"color":"rgba(34,168,132,1)"},"error_y":{"color":"rgba(34,168,132,1)"},"error_x":{"color":"rgba(34,168,132,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["65 to 69"],"y":[983],"type":"bar","name":"65 to 69","marker":{"color":"rgba(42,120,142,1)","line":{"color":"rgba(42,120,142,1)"}},"textfont":{"color":"rgba(42,120,142,1)"},"error_y":{"color":"rgba(42,120,142,1)"},"error_x":{"color":"rgba(42,120,142,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["85 to 89"],"y":[888],"type":"bar","name":"85 to 89","marker":{"color":"rgba(65,68,135,1)","line":{"color":"rgba(65,68,135,1)"}},"textfont":{"color":"rgba(65,68,135,1)"},"error_y":{"color":"rgba(65,68,135,1)"},"error_x":{"color":"rgba(65,68,135,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["90+"],"y":[534],"type":"bar","name":"90+","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":["More than one DKRF primary"],"y":[8],"type":"bar","name":"More than one DKRF primary","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["DKRF"],"y":[27],"type":"bar","name":"DKRF","marker":{"color":"rgba(65,68,135,1)","line":{"color":"rgba(65,68,135,1)"}},"textfont":{"color":"rgba(65,68,135,1)"},"error_y":{"color":"rgba(65,68,135,1)"},"error_x":{"color":"rgba(65,68,135,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["Other, non-hispanic"],"y":[187],"type":"bar","name":"Other, non-hispanic","marker":{"color":"rgba(42,120,142,1)","line":{"color":"rgba(42,120,142,1)"}},"textfont":{"color":"rgba(42,120,142,1)"},"error_y":{"color":"rgba(42,120,142,1)"},"error_x":{"color":"rgba(42,120,142,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["Hispanic"],"y":[382],"type":"bar","name":"Hispanic","marker":{"color":"rgba(34,168,132,1)","line":{"color":"rgba(34,168,132,1)"}},"textfont":{"color":"rgba(34,168,132,1)"},"error_y":{"color":"rgba(34,168,132,1)"},"error_x":{"color":"rgba(34,168,132,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["Black, non-hispanic"],"y":[1412],"type":"bar","name":"Black, non-hispanic","marker":{"color":"rgba(122,209,81,1)","line":{"color":"rgba(122,209,81,1)"}},"textfont":{"color":"rgba(122,209,81,1)"},"error_y":{"color":"rgba(122,209,81,1)"},"error_x":{"color":"rgba(122,209,81,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"x":["White, non-hispanic"],"y":[4812],"type":"bar","name":"White, non-hispanic","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"xaxis":"x3","yaxis":"y3","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"tickfont":{"size":11},"type":"category","categoryorder":"array","categoryarray":["Male","Female"],"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"tickfont":{"size":11},"type":"category","categoryorder":"array","categoryarray":["90+","85 to 89","65 to 69","80 to 84","75 to 79","70 to 74"],"anchor":"y2"},"xaxis3":{"domain":[0,1],"automargin":true,"tickfont":{"size":11},"type":"category","categoryorder":"array","categoryarray":["More than one DKRF primary","DKRF","Other, non-hispanic","Hispanic","Black, non-hispanic","White, non-hispanic"],"anchor":"y3","title":"categories"},"yaxis3":{"domain":[0,0.313333333333333],"automargin":true,"anchor":"x3"},"yaxis2":{"domain":[0.353333333333333,0.646666666666667],"automargin":true,"anchor":"x2","title":"frequency"},"yaxis":{"domain":[0.686666666666667,1],"automargin":true,"anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"f8f8f8","title":{"text":"Demographic frequencies"},"titlefont":{"size":14},"showlegend":false,"hovermode":"closest","legend":{"font":{"size":10}}},"attrs":{"1380940a5778e":{"x":{},"y":{},"color":{},"colors":"viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"138092f4c2cca":{"x":{},"y":{},"color":{},"colors":"viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"1380932109a08":{"x":{},"y":{},"color":{},"colors":"viridis","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

Plotting of likes living situation predictor against PHQ-2, stratified
by race (EM) \#currently broken :( can anyone tell why?

``` r
ll_white = 
  nhats %>%   
  filter(race_ethnicity == 1 ) %>% 
  plot_ly(x = ~jitter(likes_living_situation, 1), y = ~jitter(phq.total, 1), color = ~likes_living_situation, type = "scatter", 
          mode = "markers", marker = list(color = "red")) %>% 
  layout(plot_bgcolor = "fffefa") 

ll_black = 
  nhats %>%   
  filter(race_ethnicity == 2 ) %>% 
  plot_ly(x = ~jitter(likes_living_situation, 1), y = ~jitter(phq.total, 1), color = ~likes_living_situation, type = "scatter", 
          mode = "markers", marker = list(color = "blue")) %>% 
  layout(plot_bgcolor = "fffefa") 

ll_other = 
  nhats %>%   
  filter(race_ethnicity == 3 ) %>% 
  plot_ly(x = ~jitter(likes_living_situation, 1), y = ~jitter(phq.total, 1), color = ~likes_living_situation, type = "scatter", 
          mode = "markers", marker = list(color = "green")) %>% 
  layout(plot_bgcolor = "fffefa") 

ll_hisp = 
  nhats %>%   
  filter(race_ethnicity == 4 ) %>% 
  plot_ly(x = ~jitter(likes_living_situation, 1), y = ~jitter(phq.total, 1), color = ~likes_living_situation, type = "scatter", 
          mode = "markers", marker = list(color = "orange")) %>% 
  layout(plot_bgcolor = "fffefa") 


ll_scatter = subplot(ll_white, ll_black, ll_other, ll_hisp, nrows = 4) %>%
  layout(xaxis4 = list(title = "likes living situation"), 
         yaxis2 = list(title = "PHQ-2"),
         title = list(text = "Participant view of living situation and PHQ-2 score distribution"), 
         titlefont = list(size = 14),
         legend = list(font = list(size = 10)))

ll_scatter 
```

    ## Warning: The titlefont attribute is deprecated. Use title = list(font = ...)
    ## instead.

<div id="htmlwidget-45300a4afc2d23a5f891" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-45300a4afc2d23a5f891">{"x":{"data":[{"mode":"markers","marker":{"color":"red","line":{"color":"rgba(31,119,180,1)"}},"type":"scatter","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"markers","marker":{"color":"blue","line":{"color":"rgba(255,127,14,1)"}},"type":"scatter","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"mode":"markers","marker":{"color":"green","line":{"color":"rgba(44,160,44,1)"}},"type":"scatter","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x3","yaxis":"y3","frame":null},{"mode":"markers","marker":{"color":"orange","line":{"color":"rgba(214,39,40,1)"}},"type":"scatter","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x4","yaxis":"y4","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"anchor":"y2"},"xaxis3":{"domain":[0,1],"automargin":true,"anchor":"y3"},"xaxis4":{"domain":[0,1],"automargin":true,"anchor":"y4","title":"likes living situation"},"yaxis4":{"domain":[0,0.23],"automargin":true,"anchor":"x4"},"yaxis3":{"domain":[0.27,0.48],"automargin":true,"anchor":"x3"},"yaxis2":{"domain":[0.52,0.73],"automargin":true,"anchor":"x2","title":"PHQ-2"},"yaxis":{"domain":[0.77,1],"automargin":true,"anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"fffefa","hovermode":"closest","showlegend":true,"title":{"text":"Participant view of living situation and PHQ-2 score distribution"},"titlefont":{"size":14},"legend":{"font":{"size":10}}},"attrs":{"138092dccaf98":{"x":{},"y":{},"mode":"markers","marker":{"color":"red"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"13809591c3ba5":{"x":{},"y":{},"mode":"markers","marker":{"color":"blue"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"138094c8ffb57":{"x":{},"y":{},"mode":"markers","marker":{"color":"green"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"13809be3406":{"x":{},"y":{},"mode":"markers","marker":{"color":"orange"},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

Plotting social network and health by phq\_cat:

``` r
sn_phq = nhats %>% 
  ggplot(aes(x = sn5dnumsn, group = phq_cat)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat = "count") +
    geom_text(aes( label = scales::percent(round(..prop.., 3)),
                   y = ..prop.. ), stat = "count", vjust = -.3, size = 2.5) +
    labs(y = "Percent", fill = "SN") +
    facet_grid(~phq_cat) +
    scale_y_continuous(labels = scales::percent)

ggplotly(sn_phq)
```

<div id="htmlwidget-39eae5a890653c4c09e5" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-39eae5a890653c4c09e5">{"x":{"data":[{"orientation":"v","width":0.9,"base":0,"x":[0],"y":[0.0478572619643155],"text":"sn5dnumsn: 0<br />phq_cat: Mild/No Depression<br />prop: 0.04785726<br />factor(x): 0","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"0","legendgroup":"0","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[0],"y":[0.0661853188929001],"text":"sn5dnumsn: 0<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06618532<br />factor(x): 0","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"0","legendgroup":"0","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.327830581957645],"text":"sn5dnumsn: 1<br />phq_cat: Mild/No Depression<br />prop: 0.32783058<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(183,159,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.34777376654633],"text":"sn5dnumsn: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.34777377<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(183,159,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.268634317158579],"text":"sn5dnumsn: 2<br />phq_cat: Mild/No Depression<br />prop: 0.26863432<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.290012033694344],"text":"sn5dnumsn: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29001203<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.177088544272136],"text":"sn5dnumsn: 3<br />phq_cat: Mild/No Depression<br />prop: 0.17708854<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.161251504211793],"text":"sn5dnumsn: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.16125150<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.096381524095381],"text":"sn5dnumsn: 4<br />phq_cat: Mild/No Depression<br />prop: 0.09638152<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.0697954271961492],"text":"sn5dnumsn: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06979543<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.0822077705519426],"text":"sn5dnumsn: 5<br />phq_cat: Mild/No Depression<br />prop: 0.08220777<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(245,100,227,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.0649819494584837],"text":"sn5dnumsn: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06498195<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(245,100,227,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5],"y":[0.0478572619643155,0.327830581957645,0.268634317158579,0.177088544272136,0.096381524095381,0.0822077705519426],"text":["4.80%","32.80%","26.90%","17.70%","9.60%","8.20%"],"hovertext":["sn5dnumsn: 0<br />phq_cat: Mild/No Depression<br />prop: 0.04785726<br />scales::percent(round(prop, 3)): 4.80%","sn5dnumsn: 1<br />phq_cat: Mild/No Depression<br />prop: 0.32783058<br />scales::percent(round(prop, 3)): 32.80%","sn5dnumsn: 2<br />phq_cat: Mild/No Depression<br />prop: 0.26863432<br />scales::percent(round(prop, 3)): 26.90%","sn5dnumsn: 3<br />phq_cat: Mild/No Depression<br />prop: 0.17708854<br />scales::percent(round(prop, 3)): 17.70%","sn5dnumsn: 4<br />phq_cat: Mild/No Depression<br />prop: 0.09638152<br />scales::percent(round(prop, 3)): 9.60%","sn5dnumsn: 5<br />phq_cat: Mild/No Depression<br />prop: 0.08220777<br />scales::percent(round(prop, 3)): 8.20%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,1,2,3,4,5],"y":[0.0661853188929001,0.34777376654633,0.290012033694344,0.161251504211793,0.0697954271961492,0.0649819494584837],"text":["6.60%","34.80%","29.00%","16.10%","7.00%","6.50%"],"hovertext":["sn5dnumsn: 0<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06618532<br />scales::percent(round(prop, 3)): 6.60%","sn5dnumsn: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.34777377<br />scales::percent(round(prop, 3)): 34.80%","sn5dnumsn: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29001203<br />scales::percent(round(prop, 3)): 29.00%","sn5dnumsn: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.16125150<br />scales::percent(round(prop, 3)): 16.10%","sn5dnumsn: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06979543<br />scales::percent(round(prop, 3)): 7.00%","sn5dnumsn: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.06498195<br />scales::percent(round(prop, 3)): 6.50%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.9178082191781,"r":18.9954337899543,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[-0.745,5.745],"tickmode":"array","ticktext":["0","2","4"],"tickvals":[0,2,4],"categoryorder":"array","categoryarray":["0","2","4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"sn5dnumsn","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":"Percent","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.7625570776256},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0173886883273165,0.365162454873646],"tickmode":"array","ticktext":["0%","10%","20%","30%"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0%","10%","20%","30%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[-0.745,5.745],"tickmode":"array","ticktext":["0","2","4"],"tickvals":[0,2,4],"categoryorder":"array","categoryarray":["0","2","4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"SN","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"1380965520a8f":{"x":{},"y":{},"fill":{},"type":"bar"},"138096d336640":{"x":{},"y":{},"label":{}}},"cur_data":"1380965520a8f","visdat":{"1380965520a8f":["function (y) ","x"],"138096d336640":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

``` r
health_phq = nhats %>% 
  filter(hc5health > 0) %>%
  ggplot(aes(x = hc5health, group = phq_cat)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat = "count") +
    geom_text(aes( label = scales::percent(round(..prop.., 3)),
                   y = ..prop.. ), stat = "count", vjust = -.3, size = 2.5) +
    labs(y = "Percent", fill = "SN") +
    facet_grid(~phq_cat) +
    scale_y_continuous(labels = scales::percent)

ggplotly(health_phq)
```

<div id="htmlwidget-959d81dc5bd78fb95104" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-959d81dc5bd78fb95104">{"x":{"data":[{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.130398532599633],"text":"hc5health: 1<br />phq_cat: Mild/No Depression<br />prop: 0.13039853<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[1],"y":[0.0336943441636582],"text":"hc5health: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.03369434<br />factor(x): 1","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"1","legendgroup":"1","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.31415707853927],"text":"hc5health: 2<br />phq_cat: Mild/No Depression<br />prop: 0.31415708<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[2],"y":[0.1323706377858],"text":"hc5health: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.13237064<br />factor(x): 2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"2","legendgroup":"2","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.349007837251959],"text":"hc5health: 3<br />phq_cat: Mild/No Depression<br />prop: 0.34900784<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[3],"y":[0.296028880866426],"text":"hc5health: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29602888<br />factor(x): 3","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"3","legendgroup":"3","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.175921293980323],"text":"hc5health: 4<br />phq_cat: Mild/No Depression<br />prop: 0.17592129<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[4],"y":[0.351383874849579],"text":"hc5health: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.35138387<br />factor(x): 4","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"4","legendgroup":"4","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.0305152576288144],"text":"hc5health: 5<br />phq_cat: Mild/No Depression<br />prop: 0.03051526<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.9,"base":0,"x":[5],"y":[0.186522262334537],"text":"hc5health: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.18652226<br />factor(x): 5","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"5","legendgroup":"5","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5],"y":[0.130398532599633,0.31415707853927,0.349007837251959,0.175921293980323,0.0305152576288144],"text":["13.00%","31.40%","34.90%","17.60%","3.10%"],"hovertext":["hc5health: 1<br />phq_cat: Mild/No Depression<br />prop: 0.13039853<br />scales::percent(round(prop, 3)): 13.00%","hc5health: 2<br />phq_cat: Mild/No Depression<br />prop: 0.31415708<br />scales::percent(round(prop, 3)): 31.40%","hc5health: 3<br />phq_cat: Mild/No Depression<br />prop: 0.34900784<br />scales::percent(round(prop, 3)): 34.90%","hc5health: 4<br />phq_cat: Mild/No Depression<br />prop: 0.17592129<br />scales::percent(round(prop, 3)): 17.60%","hc5health: 5<br />phq_cat: Mild/No Depression<br />prop: 0.03051526<br />scales::percent(round(prop, 3)): 3.10%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5],"y":[0.0336943441636582,0.1323706377858,0.296028880866426,0.351383874849579,0.186522262334537],"text":["3.40%","13.20%","29.60%","35.10%","18.70%"],"hovertext":["hc5health: 1<br />phq_cat: Moderate/Severe Depression<br />prop: 0.03369434<br />scales::percent(round(prop, 3)): 3.40%","hc5health: 2<br />phq_cat: Moderate/Severe Depression<br />prop: 0.13237064<br />scales::percent(round(prop, 3)): 13.20%","hc5health: 3<br />phq_cat: Moderate/Severe Depression<br />prop: 0.29602888<br />scales::percent(round(prop, 3)): 29.60%","hc5health: 4<br />phq_cat: Moderate/Severe Depression<br />prop: 0.35138387<br />scales::percent(round(prop, 3)): 35.10%","hc5health: 5<br />phq_cat: Moderate/Severe Depression<br />prop: 0.18652226<br />scales::percent(round(prop, 3)): 18.70%"],"textfont":{"size":9.4488188976378,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.9178082191781,"r":18.9954337899543,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.305,5.695],"tickmode":"array","ticktext":["1","2","3","4","5"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["1","2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"hc5health","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":"Percent","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.7625570776256},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0175691937424789,0.368953068592058],"tickmode":"array","ticktext":["0%","10%","20%","30%"],"tickvals":[0,0.1,0.2,0.3],"categoryorder":"array","categoryarray":["0%","10%","20%","30%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.305,5.695],"tickmode":"array","ticktext":["1","2","3","4","5"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["1","2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"SN","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"13809508f85e4":{"x":{},"y":{},"fill":{},"type":"bar"},"138097e9f650d":{"x":{},"y":{},"label":{}}},"cur_data":"13809508f85e4","visdat":{"13809508f85e4":["function (y) ","x"],"138097e9f650d":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

### Plotting memory x depression outcomes

*onyeka*

``` r
mem_plot = nhats %>%  mutate(
                          phq_cat = factor(phq_cat),
                          cane_walker_cat = factor(md5canewlker),
                          noone_talk = factor(fl5noonetalk),
                          mem_probs = factor(cg5ofmemprob)) %>% group_by(phq_cat, mem_probs) %>% 
  summarise(n = n()) %>% mutate(
  proportion = (n / sum(n))
  )
```

    ## `summarise()` has grouped output by 'phq_cat'. You can override using the `.groups` argument.

``` r
  memory_plot = mem_plot %>%  ggplot(aes(x = mem_probs, y = proportion, group= phq_cat)) + 
    geom_line()  +  
   geom_point(alpha = 0.5, color = "red") + 
    facet_grid(~phq_cat) + 
    labs( title = "Severity of memory problems and Depression outcomes",
      x = "Severity level of problems with memory", y = " Proportion of respondents")+  
    scale_x_discrete(
      labels = c("Everyday","Most days","Some days","Rarely","Never")) + 
    scale_y_continuous(labels = scales::percent)
  
  ggplotly(memory_plot)
```

<div id="htmlwidget-d0052e3f7889a92cd8a3" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-d0052e3f7889a92cd8a3">{"x":{"data":[{"x":[1,2,3,4,5,6,7],"y":[0.000500250125062531,0.425712856428214,0.0256795064198766,0.0256795064198766,0.149908287477072,0.205769551442388,0.16675004168751],"text":["mem_probs: -8<br />proportion: 0.0005002501<br />phq_cat: Mild/No Depression","mem_probs: -1<br />proportion: 0.4257128564<br />phq_cat: Mild/No Depression","mem_probs: 1<br />proportion: 0.0256795064<br />phq_cat: Mild/No Depression","mem_probs: 2<br />proportion: 0.0256795064<br />phq_cat: Mild/No Depression","mem_probs: 3<br />proportion: 0.1499082875<br />phq_cat: Mild/No Depression","mem_probs: 4<br />proportion: 0.2057695514<br />phq_cat: Mild/No Depression","mem_probs: 5<br />proportion: 0.1667500417<br />phq_cat: Mild/No Depression"],"type":"scatter","mode":"lines+markers","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(255,0,0,1)","opacity":0.5,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)"}},"frame":null},{"x":[1,2,3,4,5,6,7],"y":[0.0036101083032491,0.26835138387485,0.0746089049338147,0.0890493381468111,0.274368231046931,0.162454873646209,0.127557160048135],"text":["mem_probs: -8<br />proportion: 0.0036101083<br />phq_cat: Moderate/Severe Depression","mem_probs: -1<br />proportion: 0.2683513839<br />phq_cat: Moderate/Severe Depression","mem_probs: 1<br />proportion: 0.0746089049<br />phq_cat: Moderate/Severe Depression","mem_probs: 2<br />proportion: 0.0890493381<br />phq_cat: Moderate/Severe Depression","mem_probs: 3<br />proportion: 0.2743682310<br />phq_cat: Moderate/Severe Depression","mem_probs: 4<br />proportion: 0.1624548736<br />phq_cat: Moderate/Severe Depression","mem_probs: 5<br />proportion: 0.1275571600<br />phq_cat: Moderate/Severe Depression"],"type":"scatter","mode":"lines+markers","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","marker":{"autocolorscale":false,"color":"rgba(255,0,0,1)","opacity":0.5,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)"}},"frame":null}],"layout":{"margin":{"t":55.4520547945205,"r":18.9954337899543,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Severity of memory problems and Depression outcomes","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.4,7.6],"tickmode":"array","ticktext":["Everyday","Most days","Some days","Rarely","Never"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["Everyday","Most days","Some days","Rarely","Never"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"Severity level of problems with memory","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":" Proportion of respondents","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-39.4520547945205},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.020760380190095,0.446973486743372],"tickmode":"array","ticktext":["0.0%","10.0%","20.0%","30.0%","40.0%"],"tickvals":[0,0.1,0.2,0.3,0.4],"categoryorder":"array","categoryarray":["0.0%","10.0%","20.0%","30.0%","40.0%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.4,7.6],"tickmode":"array","ticktext":["Everyday","Most days","Some days","Rarely","Never"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["Everyday","Most days","Some days","Rarely","Never"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"138094d2077d6":{"x":{},"y":{},"type":"scatter"},"13809e9baa29":{"x":{},"y":{}}},"cur_data":"138094d2077d6","visdat":{"138094d2077d6":["function (y) ","x"],"13809e9baa29":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

### plotting cane walker use *onyeka*

``` r
cane_plot = nhats %>%  
  mutate(
    cane_walker_cat = factor(md5canewlker)) %>% 
    filter(cane_walker_cat != -8) %>%  
    group_by(phq_cat, cane_walker_cat) %>% 
    summarise(n = n()) %>%  
    mutate(
        proportion = (n / sum(n)))
```

    ## `summarise()` has grouped output by 'phq_cat'. You can override using the `.groups` argument.

``` r
canewalker_plot = cane_plot %>%  
ggplot(aes(x = cane_walker_cat, y =proportion)) + 
  geom_col(fill= "light blue") + facet_grid(~phq_cat)+
  labs( title = "Use of cane walker wheelchair and depression outcomes",
      x = "Asked if used a cane walker wheel chair", y = " Proportion of respondents")+  
    scale_x_discrete(
      labels = c("Yes","No")) + 
    scale_y_continuous(labels = scales::percent)

  ggplotly(canewalker_plot)
```

<div id="htmlwidget-7e0adf5be6e9f6424c26" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7e0adf5be6e9f6424c26">{"x":{"data":[{"orientation":"v","width":[0.9,0.9],"base":[0,0],"x":[1,2],"y":[0.273470068367517,0.726529931632483],"text":["cane_walker_cat: 1<br />proportion: 0.2734701","cane_walker_cat: 2<br />proportion: 0.7265299"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(173,216,230,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.9,0.9],"base":[0,0],"x":[1,2],"y":[0.490974729241877,0.509025270758123],"text":["cane_walker_cat: 1<br />proportion: 0.4909747","cane_walker_cat: 2<br />proportion: 0.5090253"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(173,216,230,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":55.4520547945205,"r":18.9954337899543,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Use of cane walker wheelchair and depression outcomes","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,0.489128071319852],"automargin":true,"type":"linear","autorange":false,"range":[0.4,2.6],"tickmode":"array","ticktext":["Yes","No"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["Yes","No"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"Asked if used a cane walker wheel chair","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.9178082191781},{"text":" Proportion of respondents","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.7625570776256},{"text":"Mild/No Depression","x":0.244564035659926,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Moderate/Severe Depression","x":0.755435964340074,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0363264965816241,0.762856428214107],"tickmode":"array","ticktext":["0%","20%","40%","60%"],"tickvals":[0,0.2,0.4,0.6],"categoryorder":"array","categoryarray":["0%","20%","40%","60%"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.489128071319852,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.510871928680148,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.4,2.6],"tickmode":"array","ticktext":["Yes","No"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["Yes","No"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.510871928680148,1],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"1380951340956":{"x":{},"y":{},"type":"bar"}},"cur_data":"1380951340956","visdat":{"1380951340956":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
